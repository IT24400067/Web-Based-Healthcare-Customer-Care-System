<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Book Appointment - MediFlow Connect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'teal': {
                            50: '#f0fdfa',
                            100: '#ccfbf1',
                            200: '#99f6e4',
                            300: '#5eead4',
                            400: '#2dd4bf',
                            500: '#14b8a6',
                            600: '#0d9488',
                            700: '#0f766e',
                            800: '#115e59',
                            900: '#134e4a',
                        },
                        'cyan': {
                            50: '#ecfeff',
                            100: '#cffafe',
                            200: '#a5f3fc',
                            300: '#67e8f9',
                            400: '#22d3ee',
                            500: '#06b6d4',
                            600: '#0891b2',
                            700: '#0e7490',
                            800: '#155e75',
                            900: '#164e63',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #f0fdfa 0%, #ecfeff 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(13, 148, 136, 0.2);
            box-shadow: 0 8px 32px rgba(13, 148, 136, 0.1);
        }
        .time-slot {
            transition: all 0.3s ease;
        }
        .time-slot:hover {
            transform: translateY(-2px);
        }
        .time-slot.selected {
            background: linear-gradient(135deg, #0d9488 0%, #0891b2 100%);
            color: white;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen font-inter">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="glass-effect rounded-2xl p-8 mb-8 text-center">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">Book Appointment</h1>
            <p class="text-gray-600 text-lg mb-6">Schedule an appointment with our healthcare professionals</p>
            
            <!-- Success/Error Messages -->
            <div th:if="${param.success}" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mb-6">
                <span th:if="${param.success[0] == 'appointment_booked'}">
                    ‚úÖ Appointment booked successfully! 
                    <span th:if="${param.appointmentId}">Your appointment ID is: <strong th:text="${param.appointmentId[0]}"></strong></span>
                </span>
            </div>

            <div th:if="${param.error}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6">
                <span th:if="${param.error[0] == 'patient_name_required'}">‚ùå Patient name is required</span>
                <span th:if="${param.error[0] == 'valid_email_required'}">‚ùå Valid email address is required</span>
                <span th:if="${param.error[0] == 'doctor_required'}">‚ùå Please select a doctor</span>
                <span th:if="${param.error[0] == 'date_required'}">‚ùå Please select an appointment date</span>
                <span th:if="${param.error[0] == 'time_slot_required'}">‚ùå Please select a time slot</span>
                <span th:if="${param.error[0] == 'room_required'}">‚ùå Room information is required</span>
                <span th:if="${param.error[0] == 'schedule_required'}">‚ùå Schedule information is required</span>
                <span th:if="${param.error[0] == 'schedule_not_found'}">‚ùå Selected schedule not found</span>
                <span th:if="${param.error[0] == 'schedule_not_available'}">‚ùå Selected schedule is no longer available</span>
                <span th:if="${param.error[0] == 'invalid_date_format'}">‚ùå Invalid date format</span>
                <span th:if="${param.error[0] == 'booking_failed'}">
                    ‚ùå Failed to book appointment. 
                    <span th:if="${param.details}">Details: <span th:text="${param.details[0]}"></span></span>
                    <span th:unless="${param.details}">Please try again.</span>
                </span>
                <span th:if="${param.error[0] != 'patient_name_required' && param.error[0] != 'valid_email_required' && param.error[0] != 'doctor_required' && param.error[0] != 'date_required' && param.error[0] != 'time_slot_required' && param.error[0] != 'room_required' && param.error[0] != 'schedule_required' && param.error[0] != 'schedule_not_found' && param.error[0] != 'schedule_not_available' && param.error[0] != 'invalid_date_format' && param.error[0] != 'booking_failed'}" th:text="${param.error[0]}">Error message</span>
            </div>
            
            <div class="flex space-x-4">
                <a href="/customer.html" class="inline-block bg-teal-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-teal-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                    ‚Üê Back to Dashboard
                </a>
                <button onclick="loadAppointmentHistory()" class="inline-block bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                    üìã View My Appointments
                </button>
            </div>
        </div>

        <!-- Hidden field to store customer email for JavaScript -->
        <input type="hidden" id="customerEmail" th:value="${customer.email}" />

        <!-- Appointment History Section -->
        <div id="appointmentHistorySection" class="glass-effect rounded-2xl p-8 mb-8 hidden">
            <div class="flex items-center justify-between mb-6 pb-4 border-b border-gray-200">
                <div class="flex items-center">
                    <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full flex items-center justify-center text-white text-2xl mr-4">
                        üìã
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">My Appointment History</h2>
                </div>
                <button onclick="hideAppointmentHistory()" class="text-gray-500 hover:text-gray-700 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="appointmentHistoryContent">
                <!-- Appointment history will be loaded here -->
            </div>
        </div>

        <!-- Appointment Form Card -->
        <div class="glass-effect rounded-2xl p-8">
            <div class="flex items-center mb-6 pb-4 border-b border-gray-200">
                <div class="w-16 h-16 bg-gradient-to-r from-teal-500 to-cyan-500 rounded-full flex items-center justify-center text-white text-2xl mr-4">
                    üìÖ
                </div>
                <h2 class="text-2xl font-bold text-gray-800">Book Appointment</h2>
            </div>
            
            <p class="text-gray-600 mb-6">Schedule an appointment with a doctor</p>
            
            <form th:action="@{/customer/appointments/book}" method="post" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="patientName" class="block text-gray-700 font-medium mb-2">Patient Name</label>
                        <input type="text" id="patientName" name="patientName" required 
                               class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 bg-white text-gray-800 placeholder-gray-400 focus:border-teal-500 focus:outline-none focus:ring-2 focus:ring-teal-500/50 transition-all duration-300"
                               placeholder="Enter patient name" th:value="${customer.firstName + ' ' + customer.lastName}">
                    </div>
                    
                    <div>
                        <label for="patientEmail" class="block text-gray-700 font-medium mb-2">Patient Email</label>
                        <input type="email" id="patientEmail" name="patientEmail" required 
                               class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 bg-white text-gray-800 placeholder-gray-400 focus:border-teal-500 focus:outline-none focus:ring-2 focus:ring-teal-500/50 transition-all duration-300"
                               placeholder="Enter patient email" th:value="${customer.email}">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="doctorId" class="block text-gray-700 font-medium mb-2">Select Doctor</label>
                        <select id="doctorId" name="doctorId" required onchange="loadAvailableTimeSlots()"
                                class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 bg-white text-gray-800 focus:border-teal-500 focus:outline-none focus:ring-2 focus:ring-teal-500/50 transition-all duration-300">
                            <option value="">Choose a doctor...</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="appointmentDate" class="block text-gray-700 font-medium mb-2">Appointment Date</label>
                        <input type="date" id="appointmentDate" name="appointmentDate" required onchange="loadAvailableTimeSlots()"
                               class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 bg-white text-gray-800 focus:border-teal-500 focus:outline-none focus:ring-2 focus:ring-teal-500/50 transition-all duration-300">
                    </div>
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Available Time Slots</label>
                    <div id="timeSlotsContainer" class="hidden">
                        <div id="timeSlotsLoading" class="text-center py-8 text-gray-600">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-white"></div>
                            <p class="mt-2">Loading available time slots...</p>
                        </div>
                        <div id="timeSlotsList" class="hidden"></div>
                    </div>
                    <div id="timeSlotsMessage" class="text-center py-8 text-gray-600 italic">
                        Please select a doctor and date to see available time slots
                    </div>
                </div>
                
                
                <button type="submit" 
                        class="w-full bg-gradient-to-r from-teal-500 to-cyan-500 text-white px-8 py-4 rounded-lg font-semibold hover:from-teal-600 hover:to-cyan-600 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                    Book Appointment
                </button>
            </form>
        </div>
    </div>

    <script>
        // Set minimum date to today
        document.getElementById('appointmentDate').min = new Date().toISOString().split('T')[0];

        // Global variable to store selected time slot
        let selectedTimeSlot = null;
        let doctors = [];
        let schedules = [];

        // Load doctors when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadDoctors();
            setupFormSubmission();
        });

        // Helper function to show error messages
        function showError(message) {
            // You can implement a toast notification or alert here
            alert(message);
        }

        // Function to load doctors from API
        async function loadDoctors() {
            try {
                const response = await fetch('/api/schedules/doctors');
                if (response.ok) {
                    doctors = await response.json();
                    populateDoctorDropdown();
                } else {
                    console.error('Failed to load doctors');
                    showError('Failed to load doctors. Please refresh the page.');
                }
            } catch (error) {
                console.error('Error loading doctors:', error);
                showError('Error loading doctors. Please check your connection.');
            }
        }

        // Function to populate doctor dropdown
        function populateDoctorDropdown() {
            const doctorSelect = document.getElementById('doctorId');
            doctorSelect.innerHTML = '<option value="">Choose a doctor...</option>';
            
            doctors.forEach(doctor => {
                const option = document.createElement('option');
                option.value = doctor.docId;
                option.textContent = `Dr. ${doctor.doctorName} - ${doctor.specialization}`;
                doctorSelect.appendChild(option);
            });
        }

        // Function to load schedules from API
        async function loadSchedules() {
            try {
                console.log('Fetching schedules from API...');
                const response = await fetch('/api/schedules/available');
                if (response.ok) {
                    schedules = await response.json();
                    console.log('Successfully loaded schedules:', schedules.length);
                    console.log('Sample schedule:', schedules[0]);
                } else {
                    console.error('Failed to load schedules, status:', response.status);
                    schedules = [];
                }
            } catch (error) {
                console.error('Error loading schedules:', error);
                schedules = [];
            }
        }

        async function loadAvailableTimeSlots() {
            const doctorId = document.getElementById('doctorId').value;
            const appointmentDate = document.getElementById('appointmentDate').value;
            const timeSlotsContainer = document.getElementById('timeSlotsContainer');
            const timeSlotsLoading = document.getElementById('timeSlotsLoading');
            const timeSlotsList = document.getElementById('timeSlotsList');
            const timeSlotsMessage = document.getElementById('timeSlotsMessage');
            
            console.log('Loading time slots for:', { doctorId, appointmentDate });
            
            // Reset selection
            selectedTimeSlot = null;
            
            if (!doctorId || !appointmentDate) {
                timeSlotsContainer.classList.add('hidden');
                timeSlotsMessage.classList.remove('hidden');
                timeSlotsMessage.textContent = 'Please select a doctor and date to see available time slots';
                return;
            }
            
            // Show loading state
            timeSlotsContainer.classList.remove('hidden');
            timeSlotsLoading.classList.remove('hidden');
            timeSlotsList.classList.add('hidden');
            timeSlotsMessage.classList.add('hidden');
            
            try {
                // Use the specific endpoint for doctor and date
                const response = await fetch(`/api/schedules/doctor/${doctorId}/date/${appointmentDate}`);
                console.log('API response status:', response.status);
                
                if (response.ok) {
                    const filteredSchedules = await response.json();
                    console.log('Filtered schedules from API:', filteredSchedules.length);
                    console.log('Sample schedule:', filteredSchedules[0]);
                    
                    // Hide loading
                    timeSlotsLoading.classList.add('hidden');
                    
                    if (filteredSchedules.length > 0) {
                        displayTimeSlots(filteredSchedules);
                    } else {
                        timeSlotsList.innerHTML = '<div class="text-center py-8 text-gray-600">No available time slots for this doctor on the selected date. Please try a different date or doctor.</div>';
                        timeSlotsList.classList.remove('hidden');
                    }
                } else {
                    console.error('Failed to load schedules, status:', response.status);
                    timeSlotsLoading.classList.add('hidden');
                    timeSlotsList.innerHTML = '<div class="text-center py-8 text-red-600">Error loading time slots. Please try again.</div>';
                    timeSlotsList.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error loading time slots:', error);
                timeSlotsLoading.classList.add('hidden');
                timeSlotsList.innerHTML = '<div class="text-center py-8 text-red-600">Error loading time slots. Please try again.</div>';
                timeSlotsList.classList.remove('hidden');
            }
        }

        function displayTimeSlots(schedules) {
            const timeSlotsList = document.getElementById('timeSlotsList');
            
            let html = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';
            
            schedules.forEach(schedule => {
                const isAvailable = schedule.isAvailable && schedule.isActive;
                const slotClass = isAvailable ? 'time-slot cursor-pointer' : 'time-slot cursor-not-allowed opacity-60';
                const clickHandler = isAvailable ? `onclick="selectTimeSlot('${schedule.timePeriod}', '${schedule.roomId}', '${schedule.doctorScheduleId}')"` : '';
                
                // Format time display
                const startTime = formatTime(schedule.startTime);
                const endTime = formatTime(schedule.endTime);
                const timeDisplay = `${startTime} - ${endTime}`;
                
                html += `<div class="${slotClass} p-4 rounded-lg border-2 text-center ${isAvailable ? 'border-teal-300 bg-teal-50 hover:bg-teal-100' : 'border-red-300 bg-red-50'}" ${clickHandler}>`;
                html += `<div class="font-semibold text-gray-800 mb-1">${schedule.timePeriod}</div>`;
                html += `<div class="text-sm text-gray-600 mb-1">${timeDisplay}</div>`;
                html += `<div class="text-sm text-gray-600 mb-1">Room ${schedule.roomId}</div>`;
                html += `<div class="text-xs ${isAvailable ? 'text-green-600' : 'text-red-600'}">`;
                html += isAvailable ? '‚úÖ Available' : '‚ùå Unavailable';
                html += `</div>`;
                html += `</div>`;
            });
            
            html += '</div>';
            timeSlotsList.innerHTML = html;
            timeSlotsList.classList.remove('hidden');
        }

        // Helper function to format time
        function formatTime(timeString) {
            const time = new Date('1970-01-01T' + timeString);
            return time.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });
        }

        function selectTimeSlot(timePeriod, roomId, scheduleId) {
            // Remove previous selection
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
                slot.classList.add('border-teal-300', 'bg-teal-50');
                slot.classList.remove('bg-gradient-to-r', 'from-teal-500', 'to-cyan-500');
            });
            
            // Highlight selected slot
            event.target.closest('.time-slot').classList.add('selected');
            event.target.closest('.time-slot').classList.remove('border-teal-300', 'bg-teal-50');
            event.target.closest('.time-slot').classList.add('bg-gradient-to-r', 'from-teal-500', 'to-cyan-500');
            
            // Store selection
            selectedTimeSlot = {
                timePeriod: timePeriod,
                roomId: roomId,
                scheduleId: scheduleId
            };
            
            console.log('Selected time slot:', selectedTimeSlot);
        }

        // Handle form submission
        function setupFormSubmission() {
            const appointmentForm = document.querySelector('form[action*="/customer/appointments/book"]');
            if (appointmentForm) {
                appointmentForm.addEventListener('submit', function(e) {
                    console.log('Form submission started');
                    console.log('Selected time slot:', selectedTimeSlot);
                    
                    if (!selectedTimeSlot) {
                        e.preventDefault();
                        alert('Please select a time slot before booking the appointment.');
                        return false;
                    }
                    
                    // Add hidden inputs for time slot data
                    const timeSlotInput = document.createElement('input');
                    timeSlotInput.type = 'hidden';
                    timeSlotInput.name = 'timeSlot';
                    timeSlotInput.value = selectedTimeSlot.timePeriod;
                    appointmentForm.appendChild(timeSlotInput);
                    
                    const roomIdInput = document.createElement('input');
                    roomIdInput.type = 'hidden';
                    roomIdInput.name = 'roomId';
                    roomIdInput.value = selectedTimeSlot.roomId;
                    appointmentForm.appendChild(roomIdInput);
                    
                    const scheduleIdInput = document.createElement('input');
                    scheduleIdInput.type = 'hidden';
                    scheduleIdInput.name = 'scheduleId';
                    scheduleIdInput.value = selectedTimeSlot.scheduleId;
                    appointmentForm.appendChild(scheduleIdInput);
                    
                    console.log('Added hidden inputs:');
                    console.log('  timeSlot:', selectedTimeSlot.timePeriod);
                    console.log('  roomId:', selectedTimeSlot.roomId);
                    console.log('  scheduleId:', selectedTimeSlot.scheduleId);
                    
                    // Let the form submit normally
                    console.log('Form submitting...');
                });
            } else {
                console.error('Appointment form not found!');
            }
        }

        // Appointment History Functions
        function loadAppointmentHistory() {
            // Get the customer email from the hidden field
            const customerEmail = document.getElementById('customerEmail')?.value || 'test@example.com';
            
            console.log('=== DEBUG: loadAppointmentHistory called ===');
            console.log('Customer email:', customerEmail);
            
            // Show the appointment history section
            const appointmentHistorySection = document.getElementById('appointmentHistorySection');
            appointmentHistorySection.classList.remove('hidden');
            
            // Show loading state
            const appointmentHistoryContent = document.getElementById('appointmentHistoryContent');
            appointmentHistoryContent.innerHTML = `
                <div class="text-center py-8">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                    <p class="mt-2 text-gray-600">Loading your appointment history...</p>
                    <p class="mt-1 text-sm text-gray-500">Email: ${customerEmail}</p>
                </div>
            `;
            
            const apiUrl = `/api/appointments/patient?email=${encodeURIComponent(customerEmail)}`;
            console.log('API URL:', apiUrl);
            
            // Fetch appointments from API
            fetch(apiUrl)
                .then(response => {
                    console.log('Response status:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('=== DEBUG: API Response ===');
                    console.log('Full response:', data);
                    console.log('Success:', data.success);
                    console.log('Count:', data.count);
                    console.log('Appointments:', data.appointments);
                    
                    if (data.success) {
                        displayAppointmentHistory(data.appointments, data.count);
                    } else {
                        displayAppointmentHistoryError(data.message || 'Failed to load appointment history');
                    }
                })
                .catch(error => {
                    console.error('=== DEBUG: Error in fetch ===');
                    console.error('Error loading appointment history:', error);
                    displayAppointmentHistoryError('Error loading appointment history. Please try again.');
                });
        }
        
        function displayAppointmentHistory(appointments, count) {
            const appointmentHistoryContent = document.getElementById('appointmentHistoryContent');
            
            if (count === 0) {
                appointmentHistoryContent.innerHTML = `
                    <div class="text-center py-8">
                        <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">No Appointments Found</h3>
                        <p class="text-gray-500 mb-4">You haven't booked any appointments yet.</p>
                        <p class="text-sm text-gray-400">Use the form below to book your first appointment.</p>
                    </div>
                `;
                return;
            }
            
            let appointmentsHtml = `
                <div class="mb-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Your Appointment History</h3>
                    <p class="text-gray-600">You have ${count} appointment${count !== 1 ? 's' : ''} booked</p>
                </div>
                <div class="space-y-4">
            `;
            
            appointments.forEach(appointment => {
                const appointmentDate = new Date(appointment.appointmentDate);
                const formattedDate = appointmentDate.toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                const isUpcoming = appointmentDate >= new Date();
                const statusColor = isUpcoming ? 'text-green-600' : 'text-gray-500';
                const statusText = isUpcoming ? 'Upcoming' : 'Past';
                const statusBg = isUpcoming ? 'bg-green-100' : 'bg-gray-100';
                
                appointmentsHtml += `
                    <div class="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-semibold text-gray-900">${appointment.doctorName}</h4>
                                        <p class="text-sm text-gray-600">${appointment.specialization} - ${appointment.department}</p>
                                    </div>
                                </div>
                                <div class="ml-13">
                                    <p class="text-gray-700 mb-1"><strong>Date:</strong> ${formattedDate}</p>
                                    <p class="text-gray-700 mb-1"><strong>Patient:</strong> ${appointment.patientName}</p>
                                    <p class="text-gray-700 mb-1"><strong>Room:</strong> Room ${appointment.roomId}</p>
                                    <p class="text-gray-700"><strong>Appointment ID:</strong> #${appointment.id}</p>
                                </div>
                            </div>
                            <div class="ml-4">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${statusBg} ${statusColor}">
                                    ${statusText}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            appointmentsHtml += `
                </div>
                <div class="mt-6 text-center">
                    <button onclick="hideAppointmentHistory()" class="inline-block bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors mr-4">
                        Close History
                    </button>
                    <a href="/customer.html" class="inline-block bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        Go to Dashboard
                    </a>
                </div>
            `;
            
            appointmentHistoryContent.innerHTML = appointmentsHtml;
        }
        
        function displayAppointmentHistoryError(message) {
            const appointmentHistoryContent = document.getElementById('appointmentHistoryContent');
            appointmentHistoryContent.innerHTML = `
                <div class="text-center py-8">
                    <svg class="w-16 h-16 mx-auto mb-4 text-red-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Error Loading Appointments</h3>
                    <p class="text-gray-500 mb-4">${message}</p>
                    <button onclick="loadAppointmentHistory()" class="inline-block bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        Try Again
                    </button>
                </div>
            `;
        }
        
        function hideAppointmentHistory() {
            const appointmentHistorySection = document.getElementById('appointmentHistorySection');
            appointmentHistorySection.classList.add('hidden');
        }
    </script>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-6">
            <div class="grid md:grid-cols-3 gap-8">
                <!-- Hospital Info -->
                <div>
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="w-8 h-8 bg-gradient-to-br from-teal-500 to-cyan-500 rounded-full flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-bold">AROGYA MEDICAL CENTER</h3>
                            <p class="text-sm text-gray-400">MediFlow Connect Portal</p>
                        </div>
                    </div>
                    <p class="text-gray-400 text-sm leading-relaxed">
                        Book your medical appointments online with our convenient scheduling system.
                    </p>
                </div>

                <!-- Appointment Services -->
                <div>
                    <h4 class="font-semibold text-lg mb-4">Appointment Services</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="/customer.html" class="text-gray-400 hover:text-white transition-colors">Dashboard</a></li>
                        <li><a href="/appointment.html" class="text-gray-400 hover:text-white transition-colors">Book Appointment</a></li>
                        <li><a href="/feedback.html" class="text-gray-400 hover:text-white transition-colors">Submit Feedback</a></li>
                        <li><a href="/support-ticket.html" class="text-gray-400 hover:text-white transition-colors">Support Ticket</a></li>
                    </ul>
                </div>

                <!-- Emergency Contact -->
                <div>
                    <h4 class="font-semibold text-lg mb-4">24/7 Emergency</h4>
                    <div class="bg-red-600 rounded-lg p-4 text-center mb-4">
                        <div class="text-2xl font-bold">1313</div>
                        <div class="text-sm">Always Available</div>
                    </div>
                    <div class="text-sm text-gray-400">
                        <p>üìç Main Hospital Complex</p>
                        <p>Colombo, Sri Lanka</p>
                        <p>üìû +94 11 466 5500</p>
                    </div>
                </div>
            </div>

            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-sm text-gray-400">
                <p>&copy; 2025 Arogya Medical Center. All Rights Reserved. | MediFlow Connect Portal - Patient Services</p>
            </div>
        </div>
    </footer>
</body>
</html>