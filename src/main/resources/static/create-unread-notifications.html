<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Unread Notifications</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">üîî Create Unread Notifications</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Create Test Notifications</h2>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">User Email:</label>
                <input type="email" id="userEmail" value="bs@gmail.com" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div class="space-y-2">
                <button onclick="createUnreadNotification('APPOINTMENT', 'HIGH')" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Create Appointment Notification (HIGH)
                </button>
                <button onclick="createUnreadNotification('MEDICAL_REPORT', 'HIGH')" class="w-full bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    Create Medical Report Notification (HIGH)
                </button>
                <button onclick="createUnreadNotification('RECOMMENDATION', 'URGENT')" class="w-full bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                    Create Recommendation Notification (URGENT)
                </button>
                <button onclick="createUnreadNotification('SUPPORT_TICKET', 'MEDIUM')" class="w-full bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    Create Support Ticket Notification (MEDIUM)
                </button>
                <button onclick="createUnreadNotification('SYSTEM', 'LOW')" class="w-full bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                    Create System Notification (LOW)
                </button>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Test Notifications</h2>
            <div class="space-y-2">
                <button onclick="loadNotifications()" class="w-full bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">
                    Load Notifications
                </button>
                <button onclick="checkCount()" class="w-full bg-teal-500 text-white px-4 py-2 rounded hover:bg-teal-600">
                    Check Unread Count
                </button>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4">Results</h2>
            <pre id="results" class="bg-gray-100 p-4 rounded text-sm overflow-auto max-h-40">
Click buttons above to test...
            </pre>
        </div>
    </div>

    <script>
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const resultsElement = document.getElementById('results');
            resultsElement.textContent += `[${timestamp}] ${message}\n`;
            resultsElement.scrollTop = resultsElement.scrollHeight;
            console.log(message);
        }
        
        function getUserEmail() {
            return document.getElementById('userEmail').value;
        }
        
        async function createUnreadNotification(type, priority) {
            const userEmail = getUserEmail();
            const titles = {
                'APPOINTMENT': 'Appointment Reminder',
                'MEDICAL_REPORT': 'Medical Report Available',
                'RECOMMENDATION': 'New Medical Recommendation',
                'SUPPORT_TICKET': 'Support Ticket Update',
                'SYSTEM': 'System Notification'
            };
            
            const messages = {
                'APPOINTMENT': 'Your appointment with Dr. Smith is scheduled for tomorrow at 2:00 PM',
                'MEDICAL_REPORT': 'Your lab results from last week are now available for review',
                'RECOMMENDATION': 'You have a new medical recommendation from your doctor. Please review it.',
                'SUPPORT_TICKET': 'Your support ticket has been updated with a new response',
                'SYSTEM': 'System maintenance will be performed tonight from 2-4 AM'
            };
            
            log(`Creating ${type} notification (${priority}) for: ${userEmail}`);
            
            try {
                const response = await fetch('/api/notifications/test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `userEmail=${userEmail}&title=${titles[type]}&message=${messages[type]}&type=${type}&priority=${priority}`
                });
                
                log(`Response status: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Created notification with ID: ${data.notificationId}`);
                    log(`   Title: ${data.title}`);
                    log(`   Priority: ${data.priority}`);
                } else {
                    log(`‚ùå Error: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
            }
        }
        
        async function loadNotifications() {
            const userEmail = getUserEmail();
            log(`Loading notifications for: ${userEmail}`);
            
            try {
                const response = await fetch(`/api/notifications/user/${userEmail}`);
                log(`Response status: ${response.status}`);
                
                if (response.ok) {
                    const notifications = await response.json();
                    log(`Found ${notifications.length} notifications:`);
                    notifications.forEach((notification, index) => {
                        log(`  ${index + 1}. ${notification.title} (${notification.type}, ${notification.priority}) - Read: ${notification.isRead}`);
                    });
                } else {
                    log(`‚ùå Error: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
            }
        }
        
        async function checkCount() {
            const userEmail = getUserEmail();
            log(`Checking unread count for: ${userEmail}`);
            
            try {
                const response = await fetch(`/api/notifications/user/${userEmail}/count`);
                log(`Response status: ${response.status}`);
                
                if (response.ok) {
                    const count = await response.json();
                    log(`Unread notification count: ${count}`);
                } else {
                    log(`‚ùå Error: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
            }
        }
    </script>
</body>
</html>

